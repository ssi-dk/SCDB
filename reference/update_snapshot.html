<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='update_snapshots makes it easy to create and update a historical data table on a remote (SQL) server.
The function takes the data (.data) as it looks on a given point in time (timestamp) and then updates
(or creates) an remote table identified by db_table.
This update only stores the changes between the new data (.data) and the data currently stored on the remote.
This way, the data can be reconstructed as it looked at any point in time while taking as little space as possible.
See vignette("basic-principles") for further introduction to the function.'><title>Update a historical table — update_snapshot • SCDB</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Update a historical table — update_snapshot"><meta property="og:description" content='update_snapshots makes it easy to create and update a historical data table on a remote (SQL) server.
The function takes the data (.data) as it looks on a given point in time (timestamp) and then updates
(or creates) an remote table identified by db_table.
This update only stores the changes between the new data (.data) and the data currently stored on the remote.
This way, the data can be reconstructed as it looked at any point in time while taking as little space as possible.
See vignette("basic-principles") for further introduction to the function.'><meta property="og:image" content="https://ssi-dk.github.io/SCDB/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SCDB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/SCDB.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/slowly-changing-dimension.html">Slowly Changing Dimension methodology</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ssi-dk/SCDB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Update a historical table</h1>
      <small class="dont-index">Source: <a href="https://github.com/ssi-dk/SCDB/blob/HEAD/R/update_snapshot.R" class="external-link"><code>R/update_snapshot.R</code></a></small>
      <div class="d-none name"><code>update_snapshot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>update_snapshots</code> makes it easy to create and update a historical data table on a remote (SQL) server.
The function takes the data (<code>.data</code>) as it looks on a given point in time (<code>timestamp</code>) and then updates
(or creates) an remote table identified by <code>db_table</code>.
This update only stores the changes between the new data (<code>.data</code>) and the data currently stored on the remote.
This way, the data can be reconstructed as it looked at any point in time while taking as little space as possible.</p>
<p>See <code>vignette("basic-principles")</code> for further introduction to the function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">update_snapshot</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  <span class="va">conn</span>,</span>
<span>  <span class="va">db_table</span>,</span>
<span>  <span class="va">timestamp</span>,</span>
<span>  filters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  message <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  logger <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  enforce_chronological_order <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>.data</dt>
<dd><p>(<code>data.frame(1)</code>, <code>tibble(1)</code>, <code>data.table(1)</code>, or <code>tbl_dbi(1)</code>)<br>
Data object.</p></dd>


<dt>conn</dt>
<dd><p>(<code>DBIConnection(1)</code>)<br>
Connection object.</p></dd>


<dt>db_table</dt>
<dd><p>(<code>id-like object(1)</code>)<br>
A table specification (coercible by <code><a href="id.html">id()</a></code>).</p></dd>


<dt>timestamp</dt>
<dd><p>(<code>POSIXct(1)</code>, <code>Date(1)</code>, or <code>character(1)</code>)<br>
The timestamp describing the data being processed (not the current time).</p></dd>


<dt>filters</dt>
<dd><p>(<code>data.frame(1)</code>, <code>tibble(1)</code>, <code>data.table(1)</code>, or <code>tbl_dbi(1)</code>)<br>
A object subset data by.
If filters is <code>NULL</code>, no filtering occurs.
Otherwise, an <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join()</a></code> is performed using all columns of the filter object.</p></dd>


<dt>message</dt>
<dd><p>(<code>character(1)</code>)<br>
A message to add to the log-file (useful for supplying metadata to the log).</p></dd>


<dt>tic</dt>
<dd><p>(<code>POSIXct(1)</code>)<br>
A timestamp when computation began. If not supplied, it will be created at call-time
(used to more accurately convey the runtime of the update process).</p></dd>


<dt>logger</dt>
<dd><p>(<code>Logger(1)</code>)<br>
A configured logging object. If none is given, one is initialized with default arguments.</p></dd>


<dt>enforce_chronological_order</dt>
<dd><p>(<code>logical(1)</code>)<br>
Are updates allowed if they are chronologically earlier than latest update?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>No return value, called for side effects.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>filter_keys</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span>  <span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_connection.html">get_connection</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html" class="external-link">copy_to</a></span><span class="op">(</span><span class="va">conn</span>, <span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Copy the first 3 records</span></span></span>
<span class="r-in"><span>  <span class="fu">update_snapshot</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    conn <span class="op">=</span> <span class="va">conn</span>,</span></span>
<span class="r-in"><span>    db_table <span class="op">=</span> <span class="st">"test.mtcars"</span>,</span></span>
<span class="r-in"><span>    timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`log_path` and `log_tbl` are both `NULL` and therefore NO file or database logging will be done.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Consider adding options SCDB.log_table_id and/or SCDB.log_path to your .Rprofile</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:11.732 - runner - INFO - Started</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:11.732 - runner - INFO - Parsing data for table main.test.mtcars started</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:11.732 - runner - INFO - Given timestamp for table is 2024-03-21 09:45:11.732087</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.097 - runner - INFO - Deactivating records</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.097 - runner - INFO - After to_remove</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.189 - runner - INFO - After to_add</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.189 - runner - INFO - Deactivate records count: 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.189 - runner - INFO - Adding new records</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.382 - runner - INFO - Insert records count: 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.435 - runner - INFO - Finished processing for table main.test.mtcars</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Update with the first 5 records</span></span></span>
<span class="r-in"><span>  <span class="fu">update_snapshot</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    conn <span class="op">=</span> <span class="va">conn</span>,</span></span>
<span class="r-in"><span>    db_table <span class="op">=</span> <span class="st">"test.mtcars"</span>,</span></span>
<span class="r-in"><span>    timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`log_path` and `log_tbl` are both `NULL` and therefore NO file or database logging will be done.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Consider adding options SCDB.log_table_id and/or SCDB.log_path to your .Rprofile</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.446 - runner - INFO - Started</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.446 - runner - INFO - Parsing data for table main.test.mtcars started</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.446 - runner - INFO - Given timestamp for table is 2024-03-21 09:45:12.446499</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.851 - runner - INFO - Deactivating records</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:12.943 - runner - INFO - After to_remove</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:13.032 - runner - INFO - After to_add</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:13.032 - runner - INFO - Deactivate records count: 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:13.032 - runner - INFO - Adding new records</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:13.091 - runner - INFO - Insert records count: 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2024-03-21 09:45:13.142 - runner - INFO - Finished processing for table main.test.mtcars</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"test.mtcars"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Source:   table&lt;`test.mtcars`&gt; [5 x 14]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Database: sqlite 3.45.0 [:memory:]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb checksum    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>  21       6   160   110  3.9   2.62  16.5     0     1     4     4 1da1bd6281e…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>  21       6   160   110  3.9   2.88  17.0     0     1     4     4 7a302dae353…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1 0532ea093ca…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2 613d84d8ade…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1 7ff73a7388d…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: from_ts &lt;chr&gt;, until_ts &lt;dbl&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="close_connection.html">close_connection</a></span><span class="op">(</span><span class="va">conn</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Rasmus Skytte Randløv, Marcus Munch Grünewald, Statens Serum Institut.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

